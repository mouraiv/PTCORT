<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Exemplo de Preenchimento</title>
</head>
<body>
  <div id="navbar">
    <table id="tabela-enderecos">
      <tr>
        <th colspan="6">CEP CORREIOS</th>
      </tr>
      <tr class="header-cep_correios">
        <td></td>
        <td>Endereço</td>
        <td>Bairro</td>
        <td>Município</td>
        <td>CEP</td>
        <td>UF</td>
      </tr>

      <tr>
        <th colspan="6">OPENSTREET</th>
      </tr>
      <tr class="header-opem_street">
        <td></td>
        <td>Endereço</td>
        <td>Bairro</td>
        <td>Município</td>
        <td>CEP</td>
        <td>UF</td>
      </tr>

      <tr>
        <th colspan="6">DBC LOGRADOURO</th>
      </tr>
      <tr class="header-dbc_logradouro">
        <td></td>
        <td>Endereço</td>
        <td>Bairro</td>
        <td>Município</td>
        <td>CEP</td>
        <td>UF</td>
      </tr>
      <!-- Linhas serão adicionadas aqui via JS -->
    </table>
  </div>
<script>
  const linhaSelecionada = [];

  function criarRadio() {
    const radio = document.createElement("input");
    radio.type = "radio";
    radio.name = "grupo-radio";
    radio.dataset.checked = "false";

    radio.addEventListener("click", function () {
      if (this.dataset.checked === "true") {
        this.checked = false;
        this.dataset.checked = "false";
        linhaSelecionada.length = 0;
      } else {
        document.querySelectorAll("input[name='grupo-radio']").forEach(r => {
          r.dataset.checked = "false";
        });

        this.dataset.checked = "true";
        coletarLinhaSelecionada(this);
      }
    });

    return radio;
  }

  function coletarLinhaSelecionada(radio) {
    const tr = radio.closest("tr");
    const tds = tr.querySelectorAll("td");

    linhaSelecionada.length = 0;
    for (let i = 1; i < tds.length; i++) {
      linhaSelecionada.push(tds[i].textContent.trim());
    }

    console.log("Linha selecionada:", linhaSelecionada);
  }

  fetch("http://localhost:5000/enderecos")
    .then(res => res.json())
    .then(dados => {
      const tabela = document.getElementById("tabela-enderecos");
      const tipos = ["cep_correios", "opem_street", "dbc_logradouro"];

      tipos.forEach(tipo => {
        const dadosTipo = dados.find(item => item[tipo])?.[tipo] || [];
        const headerRow = tabela.querySelector(`.header-${tipo}`);

        dadosTipo.forEach(linha => {
          const tr = document.createElement("tr");

          const tdRadio = document.createElement("td");
          const radio = criarRadio();
          tdRadio.appendChild(radio);
          tr.appendChild(tdRadio);

          linha.forEach(valor => {
            const td = document.createElement("td");
            td.textContent = valor;
            tr.appendChild(td);
          });

          headerRow.insertAdjacentElement("afterend", tr);
        });
      });
    })
    .catch((erro) => {
      console.error("Erro ao buscar dados:", erro);
    });
</script>

</body>
</html>
